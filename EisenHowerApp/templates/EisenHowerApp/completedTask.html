{%extends "EisenHowerApp/layout.html"%}

{%block content%}

<div class="container">
    <h1>Tasks you have been completed</h1>

    <div class="finished_task_container">
        {%for t in completedTask%}
            <div class="d-flex" id="task_container_{{t.id}}">
                <form class="from delete_task_form" method="post">
                    {% csrf_token %}
                    <input type="text" name="task_id" value="{{t.id}}" hidden>
                    <div class="delete_completed_task me-2">
                        <button type="submit" id="delete_task_id" name="delete_task" class="border-0">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                    </div>
                </form>
                <div class="task_finished">
                    {{t.title}}
                </div>
            </div>
        {%endfor%}
    </div>
</div>

{%endblock%}

{%block javascript%}
<script>
    // delete task
    const task_forms = document.querySelectorAll(".delete_task_form");

    task_forms.forEach((task_form) => {
        task_form.addEventListener('submit', DeleteTask)
    })

    function DeleteTask(e){
        e.preventDefault();
        let taskID = e.target.firstChild.nextSibling.nextSibling.nextSibling.value;
        let formData = new FormData(e.target);

        fetch(`http://127.0.0.1:8000/delete_task/${taskID}`, {
            method: 'POST',
            credentials: 'same-origin',
            headers:{
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
            },
            body: formData
        })
        .then(response => {
            return response.json()
        })
        .then(data => {
            const delete_task = document.querySelector(`#task_container_${taskID}`);
            delete_task.remove();
            new Toast({
                message: data.message,
                type: 'success'
            }); 
        })
    }
</script>

{%endblock%}